{% extends 'base.html' %}
{% load static %}
{% block title %}Главная{% endblock title %}
{% block content %}
<style>
    #navbar {
    position: relative; /* Важно: установите позицию навбара как относительную */
}

#background-image {
    width: 100%;
    height: 650px;
    position: absolute;
    top: 0;
    margin-top: -50px;
    z-index: -1;
}
</style>
{% block css %} <link rel="stylesheet" href="{% static "css/homepage/homepage.css" %}" type="text/css" />{% endblock css %}

<div class='image-banner' id="background-image">
    <img src='{% static "images/pizdec_banner.png" %}'>
</div>

<div class="container-fluid text-center" style="margin-top: 450px; margin-left: 100px">
    <div class="row content">
        <div class="col-sm-8 text-left">
            <h1 class="display-3" style="color: white; font-weight: bolder">Смотреть аниме</h1>
            <div class="sorting-container">
                <div class="sorting-block">
                    <p style='color: white; margin-top: 5px'>Сортировка по:</p>
                </div>
            
                <div class="sorting-block">
                    <select class="form-select" aria-label="Default select example">
                        <option value="1">Рейтингу</option>
                        <option value="2">Дате добавления</option>
                        <option value="3">Просмотрам</option>
                    </select>
                </div>
            </div>
            <div id="anime-list" class="mini-product-container" style='margin-top:20px'></div>
            {% comment %} <div class="mini-product-container" style='margin-top: 20px'>
              
                {% for anime in anime_list %}
                 
                    <div class="mini-product-block" id="item{{anime.id}}" onmouseover="toggleText(item{{anime.id}})" onmouseout="toggleDefault(item{{anime.id}})">
                       <a href='/anime/{{ anime.id }}' style='width: 100%; height: 100%'>
                          <div class="image-container">
                            <img src='{{ anime.image.url }}' class="product-image">
                            <div class="overlay"></div>
                        </div>
                        <p class="title">{{ anime.title|slice:":30" }}{% if anime.title|length > 30 %}...{% endif %}</p>
                        <p class="description">
                          {{ anime.description|slice:":450" }}{% if anime.description|length > 450 %}...{% endif %}
                        </p> 
                      </a>
                  </div>
                
                {% endfor %}
            </div> {% endcomment %}
        </div>
      <div class="col-sm-2 sidenav" style="margin-left: 100px; margin-top: 10px">
        <div>
            <div class="update-block" style='height: 37px; margin-bottom: 10px'>
                <p style='margin-top: 5px; margin-left: 10px; font-size: 18px; font-weight: bold'>Обновления на сайте</p>
            </div>
            <div class="update-block" style='margin-bottom: 15px'>
                <div class="additional-image-container" style='margin-top: 10px; margin-left: 10px'>
                  <img src='{% static "images/berserk.jpg" %}'>
                </div>
                <div class="description-container" style='margin-top: 10px; margin-left: 10px'>
                  <p style='font-weight: bold'>Берсерк</p>
                  <p style='color: #A9A9A9'>Тип: ТВ-Сериал</p>
                  <p style='color: #A9A9A9'>Количество серий: 16/25</p>
                </div>
            </div>
            <div class="update-block" style='margin-bottom: 15px'>
                <div class="additional-image-container" style='margin-top: 10px; margin-left: 10px'>
                  <img src='{% static "images/titans.jpg" %}'>
                </div>
                <div class="description-container" style='margin-top: 10px; margin-left: 10px'>
                  <p style='font-weight: bold'>Атака титанов</p>
                  <p style='color: #A9A9A9'>Тип: ТВ-Сериал</p>
                  <p style='color: #A9A9A9'>Количество серий: 16/25</p>
                </div>
            </div>
            <div class="update-block" style='margin-bottom: 15px'>
                <div class="additional-image-container" style='margin-top: 10px; margin-left: 10px'>
                  <img src='{% static "images/vamp.png" %}'>
                </div>
                <div class="description-container" style='margin-top: 10px; margin-left: 10px'>
                  <p style='font-weight: bold'>Название</p>
                  <p style='color: #A9A9A9'>Тип: ТВ-Сериал</p>
                  <p style='color: #A9A9A9'>Количество серий: 16/25</p>
                </div>
            </div>
            <div class="update-block" style='margin-bottom: 15px'>
                <div class="additional-image-container" style='margin-top: 10px; margin-left: 10px'>
                  <img src='{% static "images/superst.png" %}'>
                </div>
                <div class="description-container" style='margin-top: 10px; margin-left: 10px'>
                  <p style='font-weight: bold'>Название</p>
                  <p style='color: #A9A9A9'>Тип: ТВ-Сериал</p>
                  <p style='color: #A9A9A9'>Количество серий: 16/25</p>
                </div>
            </div>
            <div class="update-block" style='margin-bottom: 15px'>
                <div class="additional-image-container" style='margin-top: 7px; margin-left: 10px'>
                  <img src='{% static "images/sport.png" %}'>
                </div>
                <div class="description-container" style='margin-top: 10px; margin-left: 10px'>
                  <p style='font-weight: bold'>Название</p>
                  <p style='color: #A9A9A9'>Тип: ТВ-Сериал</p>
                  <p style='color: #A9A9A9'>Количество серий: 16/25</p>
                </div>
            </div>
          </div>
          <div class="update-block" style='height: 37px; margin-bottom: 10px; margin-top: 10px'>
            <p style='margin-top: 5px; margin-left: 10px; font-size: 18px; font-weight: bold'>Обновления на сайте</p>
        </div>
        <div class="update-block" style='margin-bottom: 15px'>
            <div class="additional-image-container" style='margin-top: 10px; margin-left: 10px'>
              <img src='{% static "images/berserk.jpg" %}'>
            </div>
            <div class="description-container" style='margin-top: 10px; margin-left: 10px'>
              <p style='font-weight: bold'>Берсерк</p>
              <p style='color: #A9A9A9'>Тип: ТВ-Сериал</p>
              <p style='color: #A9A9A9'>Количество серий: 16/25</p>
            </div>
        </div>
        <div class="update-block" style='margin-bottom: 15px'>
            <div class="additional-image-container" style='margin-top: 10px; margin-left: 10px'>
              <img src='{% static "images/titans.jpg" %}'>
            </div>
            <div class="description-container" style='margin-top: 10px; margin-left: 10px'>
              <p style='font-weight: bold'>Атака титанов</p>
              <p style='color: #A9A9A9'>Тип: ТВ-Сериал</p>
              <p style='color: #A9A9A9'>Количество серий: 16/25</p>
            </div>
        </div>
        <div class="update-block" style='margin-bottom: 15px'>
            <div class="additional-image-container" style='margin-top: 10px; margin-left: 10px'>
              <img src='{% static "images/vamp.png" %}'>
            </div>
            <div class="description-container" style='margin-top: 10px; margin-left: 10px'>
              <p style='font-weight: bold'>Название</p>
              <p style='color: #A9A9A9'>Тип: ТВ-Сериал</p>
              <p style='color: #A9A9A9'>Количество серий: 16/25</p>
            </div>
        </div>
        <div class="update-block" style='margin-bottom: 15px'>
            <div class="additional-image-container" style='margin-top: 10px; margin-left: 10px'>
              <img src='{% static "images/superst.png" %}'>
            </div>
            <div class="description-container" style='margin-top: 10px; margin-left: 10px'>
              <p style='font-weight: bold'>Название</p>
              <p style='color: #A9A9A9'>Тип: ТВ-Сериал</p>
              <p style='color: #A9A9A9'>Количество серий: 16/25</p>
            </div>
        </div>
        <div class="update-block" style='margin-bottom: 15px'>
            <div class="additional-image-container" style='margin-top: 7px; margin-left: 10px'>
              <img src='{% static "images/sport.png" %}'>
            </div>
            <div class="description-container" style='margin-top: 10px; margin-left: 10px'>
              <p style='font-weight: bold'>Название</p>
              <p style='color: #A9A9A9'>Тип: ТВ-Сериал</p>
              <p style='color: #A9A9A9'>Количество серий: 16/25</p>
            </div>
        </div>
      </div>
      </div>
    </div>
</div>
<script>
    
    function toggleText(elementId) {
      var element = document.getElementById(elementId);

      if (element) {
          var title = element.querySelector('.title');
          var description = element.querySelector('.description');

          if (title && description) {
              title.style.opacity = 0; // Скрываем текст "Берсерк"
              description.style.opacity = 1; // Показываем текст "Описание"
          } else {
              console.error('Элементы с указанными классами не найдены внутри элемента с ID ' + elementId);
          }
      } else {
          console.error('Элемент с ID ' + elementId + ' не найден.');
      }
  }
    
  function toggleDefault(elementId) {
    var element = document.getElementById(elementId);

    if (element) {
        var title = element.querySelector('.title');
        var description = element.querySelector('.description');

        if (title && description) {
            title.style.opacity = 1; // Скрываем текст "Берсерк"
            description.style.opacity = 0; // Показываем текст "Описание"
        } else {
            console.error('Элементы с указанными классами не найдены внутри элемента с ID ' + elementId);
        }
    } else {
        console.error('Элемент с ID ' + elementId + ' не найден.');
    }
}
    
</script> 
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
  var loading = false;
  var page = 1;  // Начинайте с 2, так как первая страница уже загружена

  function loadMoreAnime() {
      if (!loading) {
          loading = true;

          $.ajax({
              url: '/get_anime/',
              data: { page: page },
              dataType: 'json',
              success: function (data) {
                  console.log(data); // Вывод данных в консоль для отладки

                  if (data.length > 0) {
                      var html = '';
                      for (var i = 0; i < data.length; i++) {
                          var anime = data[i];

                          // Проверяем, что свойство 'image_url' существует в объекте anime
                          var imageUrl = anime.image_url ? anime.image_url : '';

                          html += `<div class="mini-product-block" id="item${anime.id}" onmouseover="toggleText('item${anime.id}')" onmouseout="toggleDefault('item${anime.id}')">`;

                          html += '<a href="/anime/' + anime.id + '" style="width: 100%; height: 100%">';
                          html += '<div class="image-container">';
                          html += '<img src="' + imageUrl + '" class="product-image">';
                          html += '<div class="overlay"></div>';
                          html += '</div>';
                          html += '<p class="title">' + (anime.title.length > 30 ? anime.title.slice(0, 30) + '...' : anime.title) + '</p>';
                          html += '<p class="description">' + (anime.description.length > 450 ? anime.description.slice(0, 450) + '...' : anime.description) + '</p>';
                          html += '</a>';
                          html += '</div>';
                      }
                      $('#anime-list').append(html);
                      page += 1;
                  } else {
                      // Если больше нет данных, скройте кнопку загрузки
                      $('#load-more').hide();
                  }
                  loading = false;
              },
              error: function () {
                  loading = false;
              }
          });
      }
  }

  // Обработчик события прокрутки
  $(window).scroll(function () {
      if (!loading && $(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
          // Если пользователь близок к концу страницы и нет текущей загрузки
          loadMoreAnime(); // Вызов функции загрузки данных
      }
  });

  // Загрузите первую порцию данных при загрузке страницы
  loadMoreAnime();
</script>

{% endblock content %}